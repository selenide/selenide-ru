---
layout: post
title: "Вышла Selenide 3.9.1"
description: ""
category:
header-text: "Скачиваем файлы как мужик"
tags: []
---
{% include JB/setup %}

Привет!

Мы выпустили Selenide 3.9.1! 

<br/>
<br/>

### Киллер фича! Selenide умеет скачивать любые файлы! 

Мы хотели сделать это давно, и вот наконец свершилось!
Бесконечные проблемы со скачиванием файлов в селениуме ушли в прошлое. 
Теперь это легко. Всегда. Один простой метод на все случаи жизни:

```java
File report = $("input#submit").download();
```

В Selenide метод `download` существует давно.
Но до сих пор он умел скачивать файлы только по ссылке с атрибутом href: `<a href`.

Этого было недостаточно, например, в таких случаях:

* Клик по кнопке сабмитит форму, а в результате сабмита начинает скачиваться файл.
* Клик по кнопке открывает PDF в новом табе (режим "inline" - встроенный просмотрщик PDF в браузере)

Теперь же Selenide умеет скачивать любые файлы.
Для этого он использует встроенный proxy-сервер (а именно, [BrowserMobProxy](https://github.com/lightbody/browsermob-proxy))

#### Как именно работает скачивание:

1. Тест вызывает команду `$("selector").download();`
2. Selenide активизирует прокси-сервер
3. Selenide кликает элемент
4. Прокси сервер запоминает все ответы сервера (response), которые содержат http-заголовок `Content-Disposition`.
   Из него Selenide достаёт имя файла и сохранят файл с таким именем в папке `build/reports/tests`.
5. Selenide ждёт (до 4 секунд), пока в списке не появится хотя бы один файл
6. Метод `$.download()` возвращает первый скачанный файл.
7. Если за это время появились новые окна, Selenide закрывает всех их.
   Это нужно для тех случаев, когда PDF открывается в новом окне браузера. 

См. [issue #196](https://github.com/codeborne/selenide/issues/196) и 
[pull request #267](https://github.com/codeborne/selenide/pull/267).

Огромное спасибо [Demin Dmitrii](https://github.com/dimand58) за вклад в эту фичу, предложения и обсуждения!


### Прокси-сервер

Да, теперь Selenide запускает свой прокси-сервер во время запуска тестов. 

В будущем мы сможем использовать прокси-сервер для реализации многих других полезных возможностей.
Например, проверять http статусы страниц и других ресурсов, внедрять свой код в страницы и пр.

Кидайте идеи, давайте побрейнстормим!


### Предупреждение о слишком больших запросах и ответах

А вот и первое использование прокси-сервера (помимо скачивания файлов).
Теперь Selenide отслеживает размер запросов-ответов и пишет предупреждение 
в лог, если размер какого-то реквеста или респонса превышает 2 MB. 

Пока это экспериментальная фича. Расскажите, как она прижилась у вас. 
Обнаружили что-то полезное? Были ли проблемы? 

См. [issue #383](https://github.com/codeborne/selenide/issues/383)


### Теперь аннотация `SoftAsserts` нормально работает с TestNG

Оказалось, TestNG конкретная редиска и вообще нехороший фреймворк. 
Если вы объявляете `@Listeners(SoftAsserts.class)` у **одного класса**, TestNG автоматически
применяет его ко **всем** вашим классам. Нет, ну это надо было додуматься, а!

Мы нашли решение для этой проблемы. Теперь листенер `SoftAsserts` сам 
проверяет, объявлен ли он у текущего тестового класса (или его предка). 

См. [issue #384](https://github.com/codeborne/selenide/issues/384)

### Теперь аннотация `SoftAsserts` для TestNG игнорирует тесты с атрибутом "expectedExceptions" 

Если у вас есть такой тест:

```java
  @Listeners(SoftAsserts.class)
  public class MyTest {
    @Test
    public void myCheckA() {...}

    @Test(expectedExceptions = ...)
    public void myCheckB() {...}
  }
```

то очевидно, что `SoftAsserts` должны включаться в методе `myCheckA`, 
но **не** должны в методе `myCheckB`. Потому что он ожидает какую-то 
конкретную ошибку, и если `SoftAsserts` её спрячет, испортит всё дело. 

См. [issue #372](https://github.com/codeborne/selenide/issues/372)


### Исправили ошибку с basic auth в браузере IE

См. [issue #366](https://github.com/codeborne/selenide/issues/366) и
[pull request #369](https://github.com/codeborne/selenide/pull/369)

Спасибо [Anton Aftakhov](https://github.com/simple-elf) за этот pull request!

### Обновились до библиотеки gson:2.7
 
Сам Selenium использует довольно старый gson 2.3.1, а в некоторых 
проектах бывает нужен более новый. 


<br/>

## Новости 

* Моё интервью на хабре: [О Legacy-коде без максимализма](https://habrahabr.ru/company/jugru/blog/308528/)
* [Почему разработчики должны быть хорошими тестировщиками](http://asolntsev.github.io/ru/2016/08/05/why-programmer-cannot-be-true-tester/)
* Вышел [video-recorder 1.0.8](http://automation-remarks.com/videorecorder-java/) - и это чумовая вещь! Теперь production ready.
* Подкаст RadioQA [Выпуск 28: Стыд и scrum](http://radio-qa.com/28-scrum/)

<br/>
<br/>

Обновляйтесь!

[Андрей Солнцев](http://asolntsev.github.io/)

ru.selenide.org
