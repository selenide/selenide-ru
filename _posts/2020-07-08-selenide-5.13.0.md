---
layout: post
title: "Вышла Selenide 5.13.0"
description: ""
category:
header-text: "Вначале была подстрока"
tags: []
---
{% include JB/setup %}

Всем привет!

Лето не повод расслабляться! Мы выпустили релиз [Selenide 5.13.0](https://github.com/selenide/selenide/milestone/98?closed=1).  

Будьте осторожны, он может сломать ваши тесты (если они были неаккуратно сделаны).  

* [Запретили `shouldHave(text(""))`](#should-have-empty-text)
* [Убрали лишние логи из аллюра](#remove-unneeded-allure-logs)
* [Сообщение об ошибках для коллекций](#improve-collection-error-messages)
* [Скачиваем файлы без `<form>`](#fix-upload-without-form)
* [Скачиваем файлы с кавычками в имени](#download-files-with-quotes)
* [Пишем логи вебдрайвера в файл](#write-webdriver-logs-to-file)
* [Новый способ скачивания файлов `FOLDER`](#new-file-download-mode-folder)
* [Метод `$.getWrappedElement()` снова ждёт появления элемента](#get-wrapped-element-waits-for-element)
* [Статистика](#statistics)
{: .blogpost-menu}

## Метод `$.shouldHave(text(""))` кидает ошибку {#should-have-empty-text}

Возможно, самый популярный метод селенида - это `$.shouldHave(text("что-то"))`. Но даже если вы используете его каждый день, 
возможно, вы не подозреваете, что он проверяет _подстроку_. Т.е. проверка `$("h1").shouldHave(text("ello"))` сработает и для 
элемента `<h1>Hello World</h1>`.

Частный случай такой проверки - `$("h1").shouldHave(text(""))`. Такую проверку пройдёт **любой элемент**, ведь любая 
строка содержит пустую подстроку. То есть такая проверка просто _бессмысленна_. 

> Если вам нужно убедиться, что текст 
пустой, используйте `$("h1").shouldHave(exactText(""))` или `$("h1").shouldBe(empty)`. 

Мы хотим вам помочь избежать этой типичной проблемы и избавиться от бессмысленных проверок. Для этого теперь селенид 
будет бросать ошибку, если вы попытаетесь передать в метод `text("")` пустую строку или null. 

> Я попробовал Selenide 5.13.0 на своём рабочем проекте и внезапно нашёл тестов 20-30, которые падали с этой ошибкой. 
И это всё были логические ошибки в тестах! Вот какое полезное изменение вас ждёт. :)

См. [issue 1156](https://github.com/selenide/selenide/issues/1156).  
Спасибо [Roman S.A.](https://github.com/eaxdev) за [PR 1186](https://github.com/selenide/selenide/pull/1186).

## Убрали лишние логи из аллюра {#remove-unneeded-allure-logs}

Внимательные аллюровцы заметили, что селенид логирует одно и то же действие дважды. Например, при вызове такой строки: 
```java
  $(bySelector).findAll(BySelector).filter(condtion);
```

(на самом деле не только в аллюре, но и в обычном селенидовском `TextReport`)

Теперь мы убрали эти двойные логи. Пришло кое-чего порефакторить, некоторые сообщения об ошибках изменились.  
Но вроде бы всё стало лучше. Если заметили ухудшение - смело сообщайте.  

См. [issue 997](https://github.com/selenide/selenide/issues/997) и [PR 1193](https://github.com/selenide/selenide/pull/1193).

## Улучшили сообщение об ошибках для коллекций {#improve-collection-error-messages}

Ещё одна похожая история, где мы немного изменили формат ошибок при поиске элементов внутри коллекций.  
По идее теперь должно быть понятнее, что внутри чего не удалось найти.  

См. [issue 967](https://github.com/selenide/selenide/issues/967) и [PR 1189](https://github.com/selenide/selenide/pull/1189).


## Починили загрузку файлов вне тэга `<form>` {#fix-upload-without-form}

Как вы знаете, селенид позволяет загрузить одной командой несколько файлов:

```java
  $("input").uploadFile(
    new File("a.txt"),
    new File("b.txt"),
    new File("c.txt")
  );
```

Для этой загрузки мы в своё время сделали в селениде хитрый JS хак. 
Оказалось, что этот хак предполагал, что `<input>` для загрузки файла должен быть внутри тэга `<form>`. Что как бы логично.  
Но оказалось, что не у всех так. 

В общем, теперь мы упростили хак и убрали зависимость от тэга `<form>`. 

См. [issue 943](https://github.com/selenide/selenide/issues/943) и [PR 1188](https://github.com/selenide/selenide/pull/1188).

## Научились скачивать файлы с кавычками в имени {#download-files-with-quotes}

... и другими нехорошими символами. 

Оказывается, есть и такие чудаки, которые генерируют файлы, в имени которых есть кавычки. Линукс и Мак вполне умеют 
сохранять такие файлы, а вот винда никак. Теперь селенид заменяет кавычки и другие нехорошие символы на подчёркивания 
(как делают все основные браузеры). 
 
См. [issue 1196](https://github.com/selenide/selenide/issues/1196) и [PR 1199](https://github.com/selenide/selenide/pull/1199).

## Научили вебдрайвер писать свои логи в файл {#write-webdriver-logs-to-file}

До сих пор вебдрайвер, запускаемый селенидом, по умолчанию не писали никуда свои логи. 
Вам нужно было включать их явно. 

Теперь же селенид включает логи вебдрайвера. Логи пишутся в файлы вида `build/reports/tests/webdriver.ts_pid_tid.log`.  
Полный путь к файлу вы можете узнать из лога, который пишет селенид каждый раз при открытии браузера:

```java
INFO Write webdriver logs to: /andrei/build/reports/tests/webdriver.1594248139109_18125_1.log
``` 

Когда в следующий раз будете изучать аномальное поведение вебдрайвера, не забудьте туда заглянуть. 
 
См. [issue 1206](https://github.com/selenide/selenide/issues/1206) и [PR 1207](https://github.com/selenide/selenide/pull/1207).

## Добавили новый способ скачивания файлов `FOLDER` {#new-file-download-mode-folder}

Как вы знаете, до сих пор в селениде было два способа скачивания файлов: `HTTPGET` и `PROXY`.
См. [пост в нашем блоге](/2019/12/10/advent-calendar-download-files/).  

* `HTTPGET` - самый простой и надёжный. Но умеет скачивать только файлы с ссылки вида `<a href>`.
* `PROXY` - универсальный и мощный способ. Но при удалённом запуске требует доступа с машины браузера к машине тестов. 
Что порой вызывает сложности и поклонников Селеноида и Грида. 

Теперь появился третий способ: `FOLDER`. 

Чтобы его включить, просто пропишите в начале тестов: 
```java
Configuration.fileDownload = FileDownloadMode.FOLDER;
``` 

Работает он просто:
1. Кликает элемент
2. Смотрит, какие новые файлы появились в папке `build/downloads`
3. Если таких файлов несколько, пытается угадать, какой из них подходит лучше всего. 
 
Рабочий пример всегда можно найти [в тестах самого селенида](https://github.com/selenide/selenide/blob/master/statics/src/test/java/integration/FileDownloadToFolderTest.java). 

<br/>
P.S. Будем пока считать этот способ _экспериментальным_, поскольку есть нюансы:
1. Работает надёжно при локальном запуске в один поток
2. При параллельном запуске одновременные тесты могут скачивать файлы в одну и ту же папку, и тогда селенид не сможет определить, кому какой файл отдать. 
3. При удалённом запуске этот способ вообще пока не работает. Тесты-то здесь, а папка там!
4. Поддерживаются Chrome, Firefox, Edge, Opera. Не поддерживаются IE и Safari (у в принципе 
нет возможности задать папку для скачивания файлов). 

Мы будем работать над этим, а вы делитесь своими соображениями, как разрулить вышеозначенные проблемы.  

См. [issue 1212](https://github.com/selenide/selenide/issues/1212),
 [PR 1213](https://github.com/selenide/selenide/pull/1213) и
 [PR 1215](https://github.com/selenide/selenide/pull/1215).

UPD Позже этот метод скачивания был доработан, и теперь его смело можно использовать в проектах. 


## Метод `$.getWrappedElement()` снова ждёт появления элемента {#get-wrapped-element-waits-for-element}

Вряд ли вам это интересно, но упомянуть обязан. По сути мы откатили одно недавнее изменение.  

Допустим, у вас есть такой код:

```java
SelenideElement button = $("button");
executeJavascript("arguments[0].click()", button);
```

где `button`, допустим, появляется на экране с задержкой.  
Всю жизнь этот метод ждал появления кнопки, и лишь тогда кликал. В Selenide 5.11 нас укусила какая-то собака, и мы сделали 
так, чтобы не ждал. Никто почему-то не жаловался, а вот в моём рабочем проекте несколько тестов упали. 
 
В общем, теперь мы вернули обратно старое поведение. Теперь снова ждёт.  

См. [issue 1191](https://github.com/selenide/selenide/issues/1191) и [PR 1203](https://github.com/selenide/selenide/pull/1203).


## Обновились до BrowserUpProxy 2.1.1 {#upgrade-to-bup-2.1.1}

Ну вдруг. 

Обновляйтесь, пробуйте, делитесь впечатлениями!


## Статистика {#statistics}

И моё любимое: статистика скачиваний селенида.  
Мы пробили потолок **в 160 тысяч в месяц**!  

<center>
  <img src="{{ BASE_PATH }}/images/2020/07/selenide.downloads.png" width="800"/>
</center>

<br>
и **31+ тысяча уникальных айпишников**:

<center>
  <img src="{{ BASE_PATH }}/images/2020/07/selenide.unique-ips.png" width="800"/>
</center>

Жизнь хороша!

<br>

[Андрей Солнцев](http://asolntsev.github.io/)

ru.selenide.org
