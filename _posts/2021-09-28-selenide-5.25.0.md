---
layout: post
title: "Вышла Selenide 5.25.0"
description: ""
category:
header-text: "Нам скоро 10!"
tags: []
---
{% include JB/setup %}

Добрый вечер!  

Мы зарелизили [Selenide 5.25.0](https://github.com/selenide/selenide/milestone/131?closed=1).

Это прямо большой релиз с кучей изменений, так что запаситесь попкорном и заварите чаю. Погнали!

<br>
# Добавили поддержку OpenTest4j

Если вы ещё не слышали, [OpenTest4j](https://github.com/ota4j-team/opentest4j) - это маленькая библиотека для assertion errors, созданная по инициативе ребят из JUnit 5. Идея в том, чтобы все тестовые фреймворки кидали именно эти ошибки, а все IDE их поддерживали. Её уже давно поддерживают крупные игроки типа JUnit, TestNG, AssertJ, IDEA и Eclipse, а вот теперь ещё и Selenide. 

**Что изменится лично для вас:**  
Когда ваш UI тест падает (ну, [почти всегда](https://github.com/selenide/selenide/issues/1589)), IDEA теперь красивенько показывает внизу ссылочку `<Click to see difference>`. Вы можете её кликнуть и увидеть коасивый идеевский DIFF в отдельном диалоге. Очень удобно при отладке. 

См. [issue 969](https://github.com/selenide/selenide/issues/969) и [PR 1545](https://github.com/selenide/selenide/pull/1545).

<br/>

NB! Если вы в своих проектах использовать напрямую селенидовские классы ошибок (наследовали или кидали), то придётся чуть подпилить код, потому что мы чутка изменили сигнатуры их конструкторов:
* поменяли местами аргументы "expected" и "actual"
* убрали ненужный параметр "driver" из большинства конструкторов

<br/>

<center>
  <img src="{{ BASE_PATH }}/images/2021/09/idea-see-diff.png" width="400" style="margin-right: 20px;"/>
  <img src="{{ BASE_PATH }}/images/2021/09/idea-diff.png" width="300"/>
</center>

<br>
# Показываем стектрейс под каждой ошибкой в SoftAsserts

До сих пор селенидовские софт ассерты показывали только один общий стектрейс после всех ошибок. А удобнее видеть стектрейс под каждой, тогда легко кликнуть на нужную строчку и попасть сразу в нужное место в коде. 

Теперь стектрейс будет под каждой ошибкой. Правда, теперь общее сообщение об ошибке стало гораздо длиннее, но ведь их не должно быть часто и много, правда? ;)

См. [issue 1543](https://github.com/selenide/selenide/issues/1543) и [PR 1545](https://github.com/selenide/selenide/pull/1545)

<br>
# Добавили метод `$.shadowRoot()`

Раньше можно было только искать элементы внутри shadow root, а теперь можно получить и сам shadow root. Правда, пользы от этого пока немного, т.к. поиск внутри этого элемента не поддерживается (браузерами или вебдрайверами, я уж не знаю - запутался). 

См. [issue 1515](https://github.com/selenide/selenide/issues/1515) и [PR 1517](https://github.com/selenide/selenide/pull/1517).

<br>
# Добавили метод `$.ancestor()`

По сути это просто синоним к существующему методу `$.closest()`. Но только название `closest` было родом из JQuery (олды помнят!), а `ancestor` должно быть более понятным, т.к. это общеизвестный термин из XPath. 

См. [issue 1556](https://github.com/selenide/selenide/issues/1556).  
Спасибо [Oleg Berezhnoy](https://github.com/bereg2k) за [PR 1567](https://github.com/selenide/selenide/pull/1567)

<br>
# Обогатили методы `$.closest()` и `$.ancestor()` 

Раньше этот метод умел искать элемент только по тэгу или классу:
* `$.ancestor("table").shouldBe(visible)`
* `$.ancestor(".form").shouldBe(visible)`

То теперь добавился поиск по атрибуту:
* `$.ancestor("[argument-name]");`
* `$.ancestor("[argument-name=argument-value]");`

Спасибо [Vitali Plagov](https://github.com/plagov) за [PR 1554](https://github.com/selenide/selenide/pull/1554)

<br>
# Починили метод `$.screenshot()` на маках

В селениде есть метод `$.screenshot()`, который позволяет сделать снимок не всего экрана, а только указанного элемента.
Оказалось, что этот метод неправильно работала на MacBook: вырезал из всего экрана не ту область (из-за всей этой чехарды с пикселями на дисплее Retina).  

К счастью, мы обнаружили, что соответствующий функционал уже давно реализован в селениуме, поэтому мы вырезали костыльный код из селенида и использовали стандартный метод вебдрайвера. Работает как минимум на Chrome, Firefox, Edge. 

См. [issue 1571](https://github.com/selenide/selenide/issues/1571) и [PR 1576](https://github.com/selenide/selenide/pull/1576).

<br>
# При падении текстовых проверок селенид выдаёт точное значение на момент падения 

Ничего себе, какие старые болячки мы иногда чиним! Этот тикет был зареган аж 6 сентября 2015!

**В общем, история такая.** Допустим, в вашем тесте есть проверка 

```java
$.shouldHave(text("Hello"));
```

И стандартный таймаут в 4 секунды. И вот:
1. в течение 4 секунд селенид проверяет-проверяет текст, а он всё не тот и не тот (допустим, "Goodbye"). 
2. таймаут истекает, 
3. селенид решает кинуть ошибку, 
4. начинает составлять сообщение и добавляет к нему текущий текст элемента - а он как раз в этот момент взял и да поменялся! Допустим, на "Hello". 

Такое случается очень редко, но когда случается, может вызвать недопонимание. 
Вы видите ошибку:
> Текст не совпал. Ожидался: Hello, а был: Hello.

и чувствуете, как мозг начинает подгорать...

Теперь Селенид запоминает **именно тот текст**, который был на момент проверки, и именно его добавляет в сообщение об ошибке. Да здравствуют неподгоревшие мозги!

P.S. В будущем мы планируем этот механизм ещё больше усовершенствовать, и выводить всю историю изменений текста в течение этих несчастных 4 секунд. Больше отчётов богу отчётов!

См. [issue 217](https://github.com/selenide/selenide/issues/217) и [PR 1566](https://github.com/selenide/selenide/pull/1566).  
Спасибо [Pavel Fokin](https://github.com/fokinp) за [PR 1313](https://github.com/selenide/selenide/pull/1313)

<br>
# Запретили пустой аргумент в методе `$.matchText("")`

В селениде есть метод для проверки текста элемента регулярным выражением:
```java
$("#child_div1").should(matchText("Hel{1,2}o")));
```

И тут мы обнаружили, что метод `matchText` позволяет передать ему пустую строку, что можем привести к ложно-зелёным тестам. Теперь же при попытке вызвать `$.should(matchText("")))` вы сразу увидите такую ошибку:
```java
java.lang.IllegalArgumentException: Argument must not be null or empty string
```

См. [PR 1566](https://github.com/selenide/selenide/pull/1566/commits/3f6421226c)

<br>
# Добавили проверку `webdriver().shouldHave(title(...))`

См. [issue 1573](https://github.com/selenide/selenide/issues/1573).  
Спасибо [Ervīns Patmalnieks](https://github.com/ervuks) за [PR 1579](https://github.com/selenide/selenide/pull/1579)


<br>
# selenide-selenoid 1.2.0

Мы выпустили [`selenide-selenoid:1.2.0`](https://github.com/selenide/selenide-selenoid/releases/tag/v1.2.0) с обновлением на Selenide 5.25.0


<br>
# selenide-appium 1.7.0

Мы выпустили [`selenide-appium:1.7.0`](https://github.com/selenide/selenide-appium/releases/tag/v1.7.0) с обновлением на Selenide 5.25.0



<br>
<br>
# Ссылки

* Вышло моё [интервью с Лёшей Маршалом](https://www.youtube.com/watch?v=o_jAKaVzjyc) на ютуб канале "Тестирование ПО"
* 5-7 октября снова будет Гейзенбаг - [советую!](https://heisenbug-moscow.ru/schedule/)
* [Доклады с весеннего Гейзенбага](https://youtube.com/playlist?list=PLsVTVVvrKX9td9Zm_4nF6Ywlz6gC5_e7K)
  * В т.ч. мой доклад [Flaky tests. Метод](https://www.youtube.com/watch?v=LDjDtR6kd2c)
  * В т.ч. мой мастер-класс [Как начать проект автоматизации. Продолжение.](https://heisenbug-piter.ru/2021/spb/talks/3tg2q9jq8nvldssitjuzvr/) - [часть 1](https://www.youtube.com/watch?v=h254Tccxgq4&list=PLsVTVVvrKX9td9Zm_4nF6Ywlz6gC5_e7K&index=15&ab_channel=Heisenbug), [часть 2](https://www.youtube.com/watch?v=WETyt87o_R4&list=PLsVTVVvrKX9td9Zm_4nF6Ywlz6gC5_e7K&index=16&t=3s&ab_channel=Heisenbug).
* Лекция [Автоматизация для QA: Selenide](https://www.youtube.com/watch?v=xknQcm6H87M)
* Пост [Using Selenide & TestNG](https://www.indellient.com/blog/automated-testing-using-selenide-testng/)


<br>
# Статистика использования Селенида
<center>
  <img src="{{ BASE_PATH }}/images/2021/09/selenide.downloads.png" width="800"/>
</center>

<br>
Знаковый рубеж пройден: перевалили за **250 тысяч скачиваний** в месяц.  

<br>

## Юбилей
Кстати, мы вплотную подошли к ещё одному знаковому рубежу: в октябре Селениду исполняется... 10 лет!  
В этом сложно поверить, но [первый коммит](https://github.com/selenide/selenide/commit/3716078fc7fda8c5da01d871882d513cbd97cd0e) в репозитории был сделан аж 25 октября 2011 года. Вы только посмотрите, какой он был нелепый! :)

<br>

[Андрей Солнцев](http://asolntsev.github.io/)

ru.selenide.org
