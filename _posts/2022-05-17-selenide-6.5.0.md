---
layout: post
title: "Вышла Selenide 6.5.0"
description: ""
category:
header-text: "ремастеринг setValue"
tags: []
---
{% include JB/setup %}

<br>
# Здравствуйте, друзья!

<br>
Мы выпустили релиз [Selenide 6.5.0](https://github.com/selenide/selenide/milestone/151?closed=1).

### Теперь можно маскировать пароли в отчётах

Иногда в автотестах приходится вбивать в поля пароли и другие секретные данные. И некоторые люди 
переживают, что эти данные потом видны в отчётах (Allure или TextReport). И просят их как-нибудь скрыть. 

Лично я не понимаю, почему кого-то должен волновать пароль от тестовой среды.
(Вы же не используете одни и те же пароли во всех средах? Вы же не гоняете тесты на продакшине?)

Но мы пошли навстречу пожеланиям переживающих, и теперь вы можете маскировать или заменять секретные данные:

```java
  $("#password").setValue(withText("admin").sensitive());
                                         // заменяет на звёздочки

  $("#username").setValue(withText("john").withDisplayedText("J* username"));
                                         // заменяет на "J* username"
```

См. [issue 1768](https://github.com/selenide/selenide/issues/1768) и [PR 1770](https://github.com/selenide/selenide/pull/1770).

<br>

### Теперь можно легко выбрать дату в `<input type=date>`

Оказалось, что выбрать дату в селениуме не так-то просто.  
Если в вашем приложении есть элемент вида `<input type=date>`, то при клике в него разные браузеры 
открывают разные календарики, и при этом используют разные форматы даты. По идее они должны использовать 
формат из настроек пользователя, но на деле каждый браузер играет в свою игру.

Всё это приводят к флейки тестам, которые могут работать на одном компьютере, но внезапно упасть на другом. 

В результате моего исследования я пришёл к выводу, что единственный надёжный способ выбрать дату - это установить 
значение в фиксированном формате `yyyy-mm-dd` через JavaScript. Похоже, это работает одинаково во всех ОС и браузерах. 

И теперь Селенид предоставляет такую возможность с помощью нового метода `withDate`:

```java
  LocalDate birthday = LocalDate.parse("1979-12-31");
  $("#birthday").setValue(withDate(birthday));
```

См. [issue 1753](https://github.com/selenide/selenide/issues/1753) и [PR 1770](https://github.com/selenide/selenide/pull/1770).

<br>

### Теперь метод `$.setValue("")` поддерживает React, Vue.js и т.п.

Давно замечено, что стандартный селениумовский метод `WebElement.clean()` (в частности, использующийся в селенидовском 
`$.setValue()`) не всегда правильно работает, когда имеют дело не с обычным `<input>`, а с обёрнутыми/обвязанными 
модными конструкциями, генерируемыми всякими современными JS-фреймворками типа React, Vue.js и прочей хипстоты. 

По идее мы это починили, ждём ваших отзывов.

Теперь следующие методы реализованы не через стандартный селениумовский `WebElement.clear()`, а через 
нажатия комбинации клавиш:

#### 1. Method `$.clear()`:
```java
input.sendKeys(HOME, chord(SHIFT, END), BACK_SPACE);
```

#### 2. Method `$.setValue("")`:
```java
input.sendKeys(HOME, chord(SHIFT, END), BACK_SPACE, TAB);
```

Такой способ, похоже, работает во всех ОС и браузерах.

См. [issue 1497](https://github.com/selenide/selenide/issues/1497) и [PR 1787](https://github.com/selenide/selenide/pull/1787).

Спасибо [Alexei Vinogradov](https://github.com/vinogradoff) за исследование проблемы в [PR 1499](https://github.com/selenide/selenide/pull/1499).

<br>

### Убрали двойное событие `blur` и `change`
Из предыдущего изменения автоматически следует, что метод `$.setValue("blah")` вызывает события `blur` и `change` только единожды. 

А раньше метод `$.setValue("blah")` работал в два шага и вызывал их дважды:
* Шаг 1. `$.clear()`  // вызывало `blur` и `change`
* Шаг 2. `$.sendKeys("blah")` // ещё раз вызывало `blur` и `change`

И события на первом шаге иногда приводили к неожиданным эффектам - например, исчезанию самого поля.  
См. [issue 960](https://github.com/selenide/selenide/issues/960).

<br>

### Вызываем событие `blur` на предыдущем элементе
В предыдущем пулреквесте заодно сделали так, что метод `$.setValue("blah")` вызывает событие `blur` на предыдущем 
активном элементе. Как минимум это помогло исправить некоторые наши флейки тесты. Надеемся, поможет и вам.

См. [issue 1784](https://github.com/selenide/selenide/issues/1784) и [commit 593e6fc9005](https://github.com/selenide/selenide/commit/593e6fc900500d9).

<br>

### Теперь методы `$.setValue()` и `$.append()` проверяют, что элемент не выключен

Точнее, что элемент не находится в состоянии "disabled" или "readonly".

См. [issue 1523](https://github.com/selenide/selenide/issues/1523) и [PR 1787](https://github.com/selenide/selenide/pull/1787).

<br>

### Добавили новые проверки "interactable" и "editable"

Эти проверки уже существовали и использовались раньше внутри Селенида, но не торчали наружу. 
А теперь и вы сможете их использовать:

```java
$("input[type=file]").shouldBe(interactable);  
             // interactable = visible OR "opacity: 0"

$("input").shouldBe(editable);
             // editable = interactable AND enabled AND !readonly
```

См. [issue 1523](https://github.com/selenide/selenide/issues/1523) и [PR 1787](https://github.com/selenide/selenide/pull/1787).

<br>

### Метод `$.download(FOLDER)` дожидается полной загрузки файла 

Британские учёные обнаружили, что иногда флейки тесты вызваны тем, что файл скачивается довольно медленно, и селенид 
успевает обнаружить и скопировать к себе файл, который уже появился в `C:\Downloads`, 
но ещё не полностью загружен. 

Теперь селенид ждёт, пока в `C:\Downloads` исчезнут все файлы "*.crdownload" (для хрома) и "*.part" (для фаерфокса).
Это временный файл, создаваемый браузером на короткий период, пока скачивается файл. 

См. [issue 1779](https://github.com/selenide/selenide/issues/1779), 
[PR 1804](https://github.com/selenide/selenide/pull/1804) и [PR 1769](https://github.com/selenide/selenide/pull/1769).

<br>

### Добавили метод `stream()` для коллекций

Точнее, метод `$$.stream()` существовал и раньше, но в версии [6.2.0](/2022/01/10/selenide-6.2.0/) был помечен как deprecated. 
Теперь вместо него есть на выбор два не-deprecated метода:
* `$$.asFixedIterable().stream()`
* `$$.asDynamicIterable().stream()`

См. [issue 1773](https://github.com/selenide/selenide/issues/1773) и [PR 1774](https://github.com/selenide/selenide/pull/1774).

<br>

### Удалили встроенную селениумовскую телеметрию (OpenTelemetry) 

Я так понимаю, эта телеметрия появилась в Selenium 4. 
Не знаю, зачем она вообще нужна, но кому-то мешала (потому, что у него уже была какая-то своя телеметрия). 
Ну и нам было проще её удалить, чем поддерживать обе. 

Спасибо [Petro Ovcharenko](https://github.com/zzz) и [Aliaksandr Rasolka](https://github.com/zzz) 
за [PR 1763](https://github.com/selenide/selenide/pull/1763).

<br>

### Обновили зависимости

* Selenium [4.1.3 -> 4.1.4](https://github.com/SeleniumHQ/selenium/blob/trunk/java/CHANGELOG).
* WebDriverManager [5.1.0 -> 5.1.1](https://github.com/bonigarcia/webdrivermanager/blob/master/CHANGELOG.md)
* Netty [4.1.75.Final -> 4.1.76.Final](https://netty.io/news/2022/04/12/4-1-76-Final.html)
* Netty [4.1.76.Final -> 4.1.77.Final](https://netty.io/news/2022/05/06/2-1-77-Final.html)
* LittleProxy [2.0.7 -> 2.0.9](https://github.com/LittleProxy/LittleProxy/releases)

Кстати, проект LittleProxy переехал в отдельную [организацию на гитхабе](https://github.com/LittleProxy/LittleProxy), и 
теперь я его главный мейнтейнер. Не то, чтобы я был фанатом проксей, но он используется в селениде, и 
поддерживать его как-то надо... 

<br>

### Новости

Отдельный привет всем, кто ждал, что же тут будет в конце пресс-релиза. ;)

А будет моя презентация с последнего фестиваля TechTrain. 

<iframe src="https://docs.google.com/presentation/d/e/2PACX-1vRIZ4w6bc7wTjWVkHTfCdevRGMo81VRIgNQ-V5Bzy1FV9ldG3jtexEXnbJ79CMtOTKhao36VHKZlfs6/embed?start=false&loop=true&delayms=3000" frameborder="0" width="960" height="569" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>

<br>

Видео с TechTrain будет через несколько месяцев, а пока можете посмотреть похожее <a class="video" href="//www.youtube.com/watch?v=iIIsZRHya-w">видео из девклуба</a>. 
Оно немного другое, ибо ориентировано на другую аудиторию, но общее представление получить можно. 

<br>

Не переключайтесь!

<br>

[Андрей Солнцев](http://asolntsev.github.io/)

ru.selenide.org
