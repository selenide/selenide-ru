---
layout: post
title: "Вышла Selenide 6.7.0"
description: ""
category:
header-text: "Полные тексты, полные скриншоты"
tags: []
---
{% include JB/setup %}

<br>
# Привет!

<br>
У нас случился толстенький релиз [Selenide 6.7.0](https://github.com/selenide/selenide/milestone/154?closed=1)

### Теперь `$.shouldHave(text)` может проверять текст целиком {#holy-whole-string}

Испокон веков команда `$.shouldHave(text)` проверяла не текст целиком, а только подстроку:

```html
  <div id="freedom-to">Britney Spears</div>
```

```java
  $("#freedom-to").shouldHave(text("Brit"));  // was OK
```

Когда-то это показалось удачной идеей, потому что веб-страничка часто содержит всякие левые символы
(переводы строк, символы табуляции, непереносимые пробелы, множественные пробелы и т.п.).

Но похоже, это всё-таки была неудачная идея, т.к. новички по умолчанию предполагают, что текст проверяется целиком, и 
выхватывают свою порцию WTF, когда обнаруживают, что все их проверки проверяли немного не то. :) 

А левые символы селенид научился правильно игнорировать (например, несколько пробелов/табов/переводов подряд эквивалентны одному пробелу).

NB! Поскольку это изменение слишком уж кардинальное и наверняка сломает кучу ваших тестов, мы пока оставили по умолчанию 
старое поведение. А новое можно включить такой настройкой:
```java
  Configuration.textCheck = FULL_TEXT;
```

А когда вам нужно проверить именно подстроку, можете использовать новую проверку `partialText`:
```java
  $("#freedom-to").shouldHave(partialText("ey Spear"))
```
Возможно, мы включим этот режим по умолчанию в следующей мажорной версии Selenide 7.0.0 - а до тех пор 
**вы можете поиграться и дать нам обратную связь**.

См. [issue 1780](https://github.com/selenide/selenide/issues/1780) и [PR 1783](https://github.com/selenide/selenide/pull/1783).

<br>

### Научили Селенид делать большие скриншоты {#full-size-screenshots}

Ну наконец-то!

Как вы знаете, при падении теста селенид автоматически делает снимок экрана (скриншот), чтобы помочь вам понять, почему тест упал.
По умолчанию вебдрайвер умеет снимать не всё окно браузера, а только видимую его часть. А самое важно часто оказывается 
за пределами экрана - тест валит какая-нибудь неактивная кнопка внизу экрана или всплывшее уведомление где-нибудь в углу.    

Теперь вы можете одной строчкой подключить плагин, который снимает скриншот с полным содержимым веб-странички:

```groovy
testImplementation "com.codeborne:selenide-full-screenshot:6.7.0"
```

P.S. Фича работает только для браузеров, поддерживающих CDP (Chrome, Edge и т.д.) и Firefox.
Для остальных будут по-прежнему обычные скриншоты.

См. [issue 1799](https://github.com/selenide/selenide/issues/1799) и [PR 1858](https://github.com/selenide/selenide/pull/1858).
Спасибо [Aliaksandr Rasolka](https://github.com/rosolko) за [PR 1800](https://github.com/selenide/selenide/pull/1800).

<br>

### Добавили кэширование элементов в пэдж обжектах {#cache-lookup-annotation}

Как вы знаете, селенид поддерживает обычные селениумовские пэдж-обжекты с аннотациями `@FindBy`.
Но вот аннотацию `@CacheLookup` селенид до сих пор не поддерживал - нам это казалось ненужной оптимизацией, ведь в 
тестах большая часть времени теряется вовсе не на поиск элементов.

Но теперь вот поддерживаем, почему бы нет. Вдруг у кого-то всё настолько оптимизировано, что именно поиск элементов
стал узким горлышком. Хотел бы я посмотреть на такой проект. :) 

Спасибо [Ilya Koshaleu](https://github.com/groov1kk) за [PR 1894](https://github.com/selenide/selenide/pull/1894).

P.S. Встаёт вопрос, а не надо ли добавить кэширование и для обычных `$` и `$$`. А как это оформить - параметром, настройкой? Новым методом?

**Предлагайте ваши идеи!**

<br>

### Отменили аннотацию `@Report` {#cancel-report-testng-annotation}

Вот культура отмены добралась и до аннотаций!

Это изменение касается любителей TestNG, которые использовали селенидовский отчёт. Для этого им надо было повесить на 
тесты две аннотации:

```java
  @Listeners({TextReport.class})
  @Report
  class MyTest {...}
``` 

Почему так сделали - это долгая история про корявые принципы работы листенеров в TestNG
(вкратце: добавление аннотации листенера одному классу внезапно влияет на все остальные классы).
Но теперь мы поняли, что систему можно упростить: аннотация `@Report` больше не нужна.

А отчёт будет генерироваться для всех тестов, помеченных аннотацией `@Listeners({TextReport.class}` **и их потомков**.

См. [issue 1891](https://github.com/selenide/selenide/issues/1891) и [PR 1909](https://github.com/selenide/selenide/pull/1909).

<br>

### Декодируем имя скачанного файла {#decode-downloaded-file-name}

Оказалось, что при скачивании файла имя файла в ответе сервера иногда бывает закодировано в Base64.
А селенид считывал имя файла как есть. Теперь вот умеет расшифровывать и Base64.

См. [issue 1886](https://github.com/selenide/selenide/issues/1886) и [PR 1889](https://github.com/selenide/selenide/pull/1889).

<br>

### Починили `$.setValue()` в IE {#restore-ie-support-set-value}

Оказалось, мы недавно сломали метод `$.setValue()` в Internet Explorer.
Не то чтобы случайно: IE ведь официально отдал концы. Но жалобы были, и мы его вернули.

См. [PR 1907](https://github.com/selenide/selenide/pull/1907).

<br>

### Сделали публичным `HttpClientTimeouts` {#made-http-client-timeouts-public}

Но лишний раз туда лучше не лазать. 

См. [PR 1902](https://github.com/selenide/selenide/pull/1902).

<br>

### Вернули тип параметра `String` для `$.setValue()` {#restore-set-value-string}

Лично у меня подгорает от того, что такая проблема вообще возникла.

Подробности в [issue 1885](https://github.com/selenide/selenide/issues/1885) и [PR 1888](https://github.com/selenide/selenide/pull/1888).

<br>

### Добавили валидацию расширения файла {#validate-file-extension}

См. [PR 1887](https://github.com/selenide/selenide/pull/1887).

<br>

### Обновили зависимости {#update-dependencies}

* JUnit [from 5.8.2 to 5.9.0](https://github.com/selenide/selenide/pull/1900)
* WebDriverManager [from 5.2.1 to 5.2.3](https://github.com/selenide/selenide/pull/1901)
* Netty [from 4.1.78.Final to 4.1.79.Final](https://github.com/selenide/selenide/pull/1892)
* BrowserUpProxy [from 2.2.0 to 2.2.1](https://github.com/selenide/selenide/pull/1895)
* LittleProxy [from 2.0.9 to 2.0.10](https://github.com/selenide/selenide/pull/1896)
* ByteBuddy [from 1.12.12 to 1.12.13](https://github.com/selenide/selenide/pull/1904)

<br>

### Новости {#news}

* [Opinionated reporting framework for Selenide](https://github.com/iSYS-Software/SelenideReporter) от Ulrich Mayring
* Новая версия [Пацан накодил - пацан протестил](https://www.youtube.com/watch?v=C8MIGAjgVqE&ab_channel=KVHigh-TechClub) - Career Day, Минск, 04.06.2022
* [Extending open-source libraries: Selenide & Selenium](https://www.youtube.com/watch?v=-KGtZoFVzr8&list=PL9Z-JgiTsOYRfoG_mcRBlTUIFPIknhQ6S) - Selenium Conf, 30.07.2022
* [Автоматизація з Selenide, ввідне заняття](https://www.youtube.com/watch?v=SqiYAJfpQwY&list=PLULFH3b6unlcUrwT9hJycTvAWPFqXZO4m&ab_channel=QAClubLviv) by Роман Маринский
* [Flaky Tests](https://www.youtube.com/watch?v=-c5XT2v5gRY&ab_channel=DEVCLUB.EE) - devclub.ee, Tallinn, 05.07.2022
* Оффтопик: моё выступление на типа открытом микрофоне [про поездки на конференции в Киев](https://youtu.be/AOBEqZ0T51c) - "Твой выход", 23.07.2022, Таллинн

<br>

[Андрей Солнцев](http://asolntsev.github.io/)

ru.selenide.org
