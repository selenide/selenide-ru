---
layout: post
title: "Вышла Selenide 6.10.0"
description: ""
category:
header-text: "Покрали енота"
tags: []
---
{% include JB/setup %}

<br>
# Недобрый вечер!

Вышел новый релиз [Selenide 6.10.0](https://github.com/selenide/selenide/milestone/167?closed=1).

* [Улучшили алгоритм скачивания файлов](#slow-download-in-firefox)
* [Ускорили отрицательное скачивание файла](#fail-download-early)
* [Выбираем опции через JavaScript](#select-options-using-javascript)
* [Сделали клик "чейнебл"](#make-click-chainable)
* [Размер окна для новых вкладок](#fix-size-for-new-tabs)
* [BasicAuth со спецсимволами](#encode-basic-auth-credentials-in-url)
* [Новости](#news)
{: .blogpost-menu}

### Улучшили алгоритм скачивания файлов {#slow-download-in-firefox}

Один из алгоритмов скачивания в Selenide - это FOLDER. 
Чтобы скачать файл, он кликает нужную кнопку и ждёт, пока в папке "Downloads" появится нужный файл. 
```java
File еноты = $("#stolenRaccoonsReport").download(using(FOLDER));
assertThat(еноты).hasName("еноты.xls");
```

Проблема в том, что этот алгоритм не очень хорошо работал в Firefox, когда скачивание идёт очень медленно. 
Оказалось, что Firefox сразу создаёт в папке два файла: "еноты.xls" и "еноты.xls.part", и оба пустые. 
И лишь затем начинает их потихоньку заполнять. 

<br>
В общем, наш алгоритм стал умнее. Теперь он 
1. Ждёт, когда в папке появятся хоть какие-нибудь подходящие файлы.
2. Ждёт, когда пропадут все файлы `*part` (в Firefox). 
3. Ждёт, когда пропадут все файлы `*crdownload` (в Chrome). 
4. Ждёт, когда все файлы замрут как минимум на секунду (в остальных браузерах).

Такой подход должен обеспечить более надёжное скачивание файлов. 

См. [issue 1989](https://github.com/selenide/selenide/issues/1989) и [PR 2003](https://github.com/selenide/selenide/pull/2003).

<br>

### Ускорили отрицательное скачивание файла {#fail-download-early}

Часто люди выставляют большой таймаут на скачивание файла. Особенно если файл большой:
```java
File video = $("#skaebova").download(using(FOLDER)
  .withTimeout(Duration.ofSeconds(99))
  .withName("пыня мобшиза.MP4"));
```

Но незачем ждать так долго, если скачивание даже не началось. Например, если клик тупо не попал по кнопке 
(как это бывает, я рассказывал в [видео "Flaky tests"](https://www.youtube.com/watch?v=elQ2LGGU2bg&ab_channel=DEVCLUB.EU&t=21m32s).

Для ускорения падения теперь можно задать второй параметр "increment timeout":
```java
File video = $("#skaebova").download(using(FOLDER)
  .withTimeout(ofSeconds(99))
  .withIncrementTimeout(ofSeconds(2))
  .withName("пыня мобшиза.MP4"));
```

В этом случае общий таймаут на скачивание 99 секунд, НО если в течение 2 секунд не было никаких изменений в папке 
для скачивания, то метод выкинет ошибку сразу. 

См. [issue 1990](https://github.com/selenide/selenide/issues/1990) и [PR 2023](https://github.com/selenide/selenide/pull/2023).

<br>

### Выбираем опции в `<select>` через JavaScript {#select-options-using-javascript} 

Это должно сделать работу с селектами быстрее. И теперь селенид выкидывает более подробную ошибку, если `<select>` (или `<option>`) оказался `disabled`.

Например, для такого селекта:
```html
<select id="region">
  <option value="belgorod">Belgorod</option>
  <option value="kherson" disabled>Kherson</option>
  <option value="zaporozhia" disabled>Zaporozhia</option>
</select>
```

Попытка выбрать `disabled` опцию:
```java
$("#region").selectOption("Kherson");
```

выдаст понятную ошибку с подробным объяснением:
```java
Invalid element state [#region/option[text:Kherson]]: Cannot select a disabled option
```

Раньше эта ошибка была не такой подробной:
```java
java.lang.UnsupportedOperationException: You may not select a disabled option
```

(а ещё раньше такой тест вообще не падал, но и опцию не выбирал)

См. [issue 1553](https://github.com/selenide/selenide/issues/1553) и [PR 1876](https://github.com/selenide/selenide/pull/1876).

> Отдельное спасибо [Oleg Berezhnoy](https://github.com/bereg2k) за [PR 1553](https://github.com/selenide/selenide/pull/1553),
> который хоть и не попал в селенид, но инициировал целую дискуссию и в селениде, и в самом селениуме, в т.ч. о том, за
> что должен или не должен отвечать селениум, и что такое "просто фреймворк" и "опионейтед фреймворк". 

<br>

### Сделали `$.click(options)` "чейнебл" {#make-click-chainable}

Люди часто жалуются, что метод `$.click()` имеет тип `void`, то есть его нельзя чейнить:
```java
  $(".btn").click().should(disappear);
```

Увы, это мы исправить не можем, т.к. класс `SelenideElement` наследует метод `void click()` из селениумовского `WebElement`.

Но мы сделали "чейнебл" другой `click` метод, который с параметрами (т.н. "оверлоадед"). 
Теперь хотя бы его можно "чейнить":
```java
  $(".btn")
    .click(usingDefaultMethod())
    .should(disappear);

  $(".btn")
    .click(usingDefaultMethod().withOffset(42, 42))
    .shouldHave(cssClass("alert"));
```

См. [issue 2007](https://github.com/selenide/selenide/issues/2007) и [PR 2008](https://github.com/selenide/selenide/pull/2008).

<br>

### Исправили размер окна для новых вкладок {#fix-size-for-new-tabs}

Спасибо [Boris Osipov](https://github.com/BorisOsipov) за [PR 2017](https://github.com/selenide/selenide/pull/2017).

P.S. Исправили ещё раз в [Selenide 6.10.1](https://github.com/selenide/selenide/milestone/170?closed=1)

<br>

### Поддерживаем логин/пароль BasicAuth со спецсимволами {#encode-basic-auth-credentials-in-url}

Selenide умеет открывать сайты, защищённые паролем (т.н. BasicAuth):
```java
open("/basic-auth/hello", BASIC, 
  new BasicAuthCredentials("", "Královec", "is Czechia /:)"));
```

Эти логин-пароль добавляются либо в http заголовок `Authorization` (если прокси включён), либо в URL (если прокси выключен).

Недавно я обнаружил, что второй способ работает некорректно, если логин или пароль содержат спецсимволы. 
При добавлении в URL эти символы не экранировались, и получался невалидный URL:
```
https://Královec:is Czechia /:)@127.0.0.1:4405/basic-auth/hello
```
и браузер не мог открыть страницу. 

> Мне по-настоящему неловко, что я как-то не увидел этой страницы. Надеюсь, вы меня простите.

В общем, теперь такие хитрые пароли тоже должны работать.
Селенид экранирует все спецсимволы и генерирует корректный URL:
```
https://Kr%C3%A1lovec:is+Czechia+%2F%3A%29@127.0.0.1:27663/basic-auth/hello
```
См. [issue 2020](https://github.com/selenide/selenide/issues/2020) и [PR 2021](https://github.com/selenide/selenide/pull/2021).

<br>


### Обновили зависимости {#update-dependencies}

* Selenium from 4.5.0 to 4.6.0, см. [ченджлог](https://www.selenium.dev/blog/2022/selenium-4-6-0-released/)
* WebDriverManager from 5.3.0 to 5.3.1, см. [ченджлог](https://github.com/bonigarcia/webdrivermanager/blob/master/CHANGELOG.md#531---2022-11-04)
* BrowserUpProxy from 2.2.3 to 2.2.5, см. [ченджлог](https://github.com/valfirst/browserup-proxy/blob/master/CHANGELOG.md)
* Netty from 4.1.82.Final to 4.1.85.Final
* LittleProxy from 2.0.13 to 2.0.14, см. [ченджлог](https://github.com/LittleProxy/LittleProxy/milestone/19?closed=1)
* #2014 Bump httpclient5 from 5.1.3 to 5.2, см. [PR 2014](https://github.com/selenide/selenide/pull/2014)
* #2025 bump slf4j from 2.0.3 to 2.0.4, см. [PR 2025](https://github.com/selenide/selenide/pull/2025)

<br>

### Дочерние проекты

Также зарелизили наши дочерние проекты:
* [selenide-appium 2.3.0](https://github.com/selenide/selenide-appium/releases/tag/v2.3.0)
* [selenide-selenoid 2.3.2](https://github.com/selenide/selenide-selenoid/releases/tag/v2.3.2)

<br>

### Новости {#news}

* JetBrains выпустила AQUA - новую [IDE для автотестов](https://www.jetbrains.com/aqua/)! Клёвое лого!
* В Selenium появился свой встроенный [аналог WebDriverManager](https://www.selenium.dev/blog/2022/introducing-selenium-manager/). Кто-то уже попробовал?
* Новый фреймворк [Selenide Pages](https://gitlab.com/brewcode/selenide-pages) на базе Selenide от Maxim Kochetkov. Клёвое лого!

### Мои свежие видосы {#my-videos}

Появилось видео моих осенних докладов из таллиннского девклуба:
* [Как законтрибьютить в опенсорс, чтобы не сгореть со стыда](https://www.youtube.com/watch?v=VtX7IpCHMS8&ab_channel=DEVCLUB.EU)
* [WTF Thread Pools](https://www.youtube.com/watch?v=JKxzELiwO_o&ab_channel=DEVCLUB.EU) - как накосячить с потоками в Java (с зубодробительными примерами из Selenium)

### Видосы и читосы {#videos}

* Видос [Чтение логов из браузера через Selenide](https://www.youtube.com/watch?v=_X0rL1eUMK0&ab_channel=OlehPendrak) от Oleh Pendrak
* Пост [All About Selenide](https://www.linkedin.com/pulse/all-selenide-muhammad-naeem/) от Muhammad Naeem
* Видос [Working with web elements using Selenide](https://morioh.com/p/018678871de9) от Automation Bro
* Пост [Page Object Model](https://dev.to/automationbro/page-object-model-selenide-tutorial-series-g3g) из серии "Selenide Tutorial Series" от Automation Bro
* Пост [Как кастомизировать UI артефакты для Selenide + Selenoid + Allure (with TestOPS)](https://habr.com/ru/company/innotech/blog/696140/) на Хабре 
 
<br>

### Статистика {#statistics}

* Наша [группа в LinkedIn](https://www.linkedin.com/groups/9154550/) насчитывает уже 176 участников. Присоединяйтесь!
* Подъехала свежая статистика скачиваний Селенида. Перевалили за 470 тыщ!

<center>
  <img src="{{ BASE_PATH }}/images/2022/11/selenide.downloads.png" width="800"/>
</center>

<br>

[Андрей Солнцев](http://asolntsev.github.io/)

ru.selenide.org
