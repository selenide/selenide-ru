---
layout: post
title: "Вышла Selenide 6.11.0"
description: ""
category:
header-text: "Итоги 2022 года"
tags: []
---
{% include JB/setup %}

<center>
  <img src="{{ BASE_PATH }}/images/2023/01/selenide-6.11.0.png" width="700"/>
</center>

<br>

# С Новым Годом, друзья!

Дедушка Мороз принёс нам новый релиз [Selenide 6.11.0](https://github.com/selenide/selenide/milestone/169?closed=1).

* [Методы для копирования текста](#added-copy-paste-methods)
* [Скачивание файла за BasicAuth](#fix-download-with-credentials)
* [Скачиваем большие файлы через прокси](#download-large-files-via-proxy)
* [Неожиданные алерты](#can-handle-unexpected-alerts)
* [Пермиссии файла скриншота](#fix-screenshot-file-permission)
* [Аннотация @As для полей без @FindBy](#support-as-annotation)
* [Последний исходник страницы](#last-page-source)
* [URL страницы в ошибке](#page-url-in-error-message)
{: .blogpost-menu}


### Добавили методы для копирования текста {#added-copy-paste-methods}

Мы добавили два новых метода:
* `Selenide.copy()` - копирует выделенный текст в буфер обмена, и
* `$.paste()` вставляет текст из буфера обмена в поле ввода.

```java
open("https://best-propaganda-quotes.ru");
$("#solovjov").doubleClick(); // select the quote text
Selenide.copy();
$("[name=q]").paste();
$("[name=q]").shouldHave(text("Обсираться мелкими алмазами на берегу озера Комо"));
```

Известные ограничения: пока что эти методы не работают на серверных линуксах (без графического окружения).
Но запуск xvfb должен помочь. 

См. [issue 1817](https://github.com/selenide/selenide/issues/1817).  
Спасибо [Evgenii Plugatar](https://github.com/evpl) за [PR 2027](https://github.com/selenide/selenide/pull/2027).

<br>


### Исправили метод `Selenide.download(url)` {#fix-download-with-credentials}

...для случая, когда url содержит логин/пароль (т.е. ресурс защищён BasicAuth). 

Например, такой код раньше работал, но сломался после обновления Apache Http client:

```java
File f = Selenide.download("https://admin:tiger@the-internet.herokuapp.com/basic_auth");
```

Оказалось, что в Apache Http client усилили валидацию URL, и часть с логином и паролем больше не разрешена
(это типа небезопасная практика).

Ну а селенид теперь вырезает эту часть и посылает с запросом в заголовке `Authorization`. 

См. [issue 2037](https://github.com/selenide/selenide/issues/2037)
и [PR 2102](https://github.com/selenide/selenide/pull/2102).

<br>


### Позволяем скачивать большие файлы через прокси {#download-large-files-via-proxy}

Если вы скачиваете файлы методом `PROXY`, то размер файла не мог превышать 64 мегабайта.
Изначально это казалось разумным ограничением: зачем кому-то нужно нагружать тестовый стенд, скачивая гигантские файлы?
(64 и то многовато, по умолчанию в BrowserUpProxy вообще было 2 мегабайта; мы увеличили лимит до 64 в селениде)

Но оказалось, что иногда люди хотят тестировать именно скачивание больших файлов.
После долгих споров мы решили просто убрать это ограничение. Вам виднее, качайте сколько хотите.

```java
File favoriteMovie = $("#topMovie").download();
assertThat(favoriteMovie)
  .hasName("BadSanta.avi")
  .as("2 GB").hasSize(2147483648L);
```

P.S. Но имейте в виду, со слишком большими файлами, скорее всего, прокси всё равно не справится (либо будет скачивать слишком долго).
И BrowserUpProxy по-прежнему имеет встроенное техническое ограничение в 2 гигабайта (потому, что тип данных - Integer).

Но хотя бы файлы по 200 мегабайтов вы вполне сможете скачивать.


См. [issue 2082](https://github.com/selenide/selenide/issues/2082)
и [PR 2098](https://github.com/selenide/selenide/pull/2098).

<br>



### Можно обрабатывать неожиданные алерты {#can-handle-unexpected-alerts}

По умолчанию, селенид игнорирует неожиданные алерты в браузере 
(точнее, запускает вебдрайвер с опцией `capabilities.setCapability(UNHANDLED_PROMPT_BEHAVIOUR, ACCEPT)`).

С одной стороны, это удобно, чтобы тесты не ломались от внезапно всплывающих реклам и других бесполезных сообщений.
С другой стороны, иногда эти алерты могут содержать полезную информацию - в частности, ценное сообщение об ошибке.

Если это ваш случай, теперь вы можете переопределить эту настройку:
```java
import static org.openqa.selenium.remote.CapabilityType.UNHANDLED_PROMPT_BEHAVIOUR;
import static org.openqa.selenium.UnexpectedAlertBehaviour.ACCEPT_AND_NOTIFY;

Configuration.browserCapabilities.setCapability(UNHANDLED_PROMPT_BEHAVIOUR, ACCEPT_AND_NOTIFY);
```

И тогда при возникновении нежданных алертов вы узнаете, какой текст в них был:
```java
UnhandledAlertException: unexpected alert open: {Alert text : Как жопа, рогозин?} // chrome
UnhandledAlertException: Accepted user prompt dialog: Маршрут через мост недоступен. Чот бахнуло. // firefox
UnhandledAlertException: unexpected alert open: {Alert text : Обнаружены боевые комары-убийцы}  // edge
UnhandledAlertException: : Обнаружена грязная бомба // safari
```

См. [issue 2054](https://github.com/selenide/selenide/issues/2054)
и [PR 2095](https://github.com/selenide/selenide/pull/2095).

<br>



### Исправили пермиссии файла скриншота {#fix-screenshot-file-permission}

Как вы знаете, при падении теста селенид автоматически сохраняет скриншот и создаёт два файла: `*.png` и `*.html`. 
Так вот выяснилось, что селенид создаёт эти два файла с разными пермиссиями:

```
-rw------- 1 root root 300295 Dec 19 10:24 1671441847908.0.png
-rw-r--r-- 1 root root 185070 Dec 19 10:24 1671441847908.0.html
```

И кое-кому это помешало писать сложносочинённые CI скрипты, выполняющие команды из-под разных юзеров.
_Чем бы девопс не тешился... :)_

В общем, теперь у обоих будет "обычные" пермиссии `-rw-r--r--`. 

См. [issue 2081](https://github.com/selenide/selenide/issues/2081)
и [PR 2084](https://github.com/selenide/selenide/pull/2084).

<br>

### Поддержка аннотации `@As` для полей без `@FindBy` {#support-as-annotation}

В селениде уже давно можно задавать удобные имена элементам пэдж обжекты (т.н. "алиасы") с помощью метода `as`:

```java
class LoginPage {
  SelenideElement loginButton = $(By.xpath("/long/ugly/xpath[3]")).as("Login button");
}
```

Но кому-то показалось, что удобно было бы повесить имя элемента в начало строки, а то справа от длинного селектора оно
визуально теряется. 

В общем, теперь алиас можно задать и с помощью аннотации `@As`:

```java
class LoginPage {
  @As("Login button")
  SelenideElement loginButton = $(By.xpath("/long/ugly/xpath[3]"));
}
```

Но естественно, аннотация сработает, только если вы инициализируете пэдж обжект с помощью метода `Selenide.page()` или `Selenide.open()`

См. [issue 2087](https://github.com/selenide/selenide/issues/2087)
и [PR 2088](https://github.com/selenide/selenide/pull/2088).

<br>

### Метод для последнего сохранённого исходника страницы {#last-page-source}

Редко когда это нужно, так что не заморачивайтесь.
По сути добавили методы `ScreenShotLaboratory`:
`threadScreenshots()`, `contextScreenshots()`, `lastThreadScreenshot()`, `lastContextScreenshot()`.

Спасибо [Arman Ayvazyan](https://github.com/armanayvazyan) за [PR 2065](https://github.com/selenide/selenide/pull/2065).

<br>

### Теперь можно добавлять URL страницы в сообщение об ошибке {#page-url-in-error-message}

Кому-то это полезно, кому-то вредно. После долгих споров сделали эту возможность опциональной (в виде плагина).  

Пусть пока побудет в статусе экспериментальной возможности. 
Вероятно, с форматами сообщений об ошибках мы ещё будем играться. 

См. [issue 980](https://github.com/selenide/selenide/issues/980) и [PR 2097](https://github.com/selenide/selenide/pull/2097).

<br>

### Итоги года {#year-summary}

Подведём итоги 2022 года? За этот год Selenide был упомянут в нескольких топах:

* [5 Testing Automation Tools](https://qameta.io/blog/5-testing-automation-tools/) в блоге компании Qameta Software
* [Top Java Libraries for Automation Testing in 2022](https://hackernoon.com/top-java-libraries-for-automation-testing-in-2022)
* [Top Java Frameworks to Use in 2022](https://aglowiditsolutions.com/blog/top-java-frameworks/)

И наконец,
* Selenide упомянут на [официальном сайте Selenium](https://www.selenium.dev/ecosystem/) в разделе "Экосистема".

Количество скачиваний селенида выросло аж **в полтора раза**:
> с 302 тысяч в январе до 469 тысяч в ноябре. 

### И всё-таки {#new-year-wishes}
Это был ужасный год. Но я рад, что я смог использовать накопленный багаж в виде сайта selenide.org и его 
аудитории, чтобы распространять антивоенную позицию. Кажется, здесь собрались люди, которые эту позицию разделяют. 
Чему я тоже очень рад.  

Надеюсь, в наступившем году война закончится, виновные будут наказаны, граждане угнетённых стран сбросят наконец своих
тиранов. А сомневающиеся вытащат наконец голову из жопы.

А прекрасная свободная страна Украина отстроится и будет цвести пуще прежнего.

> И через год мы с вами увидимся в Киеве на замечательной [конференции SeleniumCamp](https://seleniumcamp.com/). 

Героям слава!

<br>


[Андрей Солнцев](http://asolntsev.github.io/)

ru.selenide.org
