---
layout: post
title: "Вышла Selenide 6.15.0"
description: ""
category:
header-text: "Нештатный сход фичeприпаса"
tags: []
---
{% include JB/setup %}

Доброй ночи!

> Есть люди, которые постоянно деплоят, а есть люди, которые один раз в жизни где-то выучили, что должен быть РЕЛИЗ — и копят, копят, копят фичи для этого релиза.    
> А счастливый дедушка-мейнтейнер думает, что ему хорошо.  
> И как использовать опенсорс-проект, если вдруг случайно окажется, что этот дедушка — законченный мудак?  


Как вы поняли, мы выпустили новую версию [Selenide 6.15.0](https://github.com/selenide/selenide/milestone/184?closed=1) 
с серьёзными такими внутренними переделками.
* [Влили проект `selenide-selenoid` в `selenide`](#merge-selenide-selenoid-to-selenide)
* [Влили проект `selenide-appium` в `selenide`](#merge-selenide-appium-to-selenide)
* [Клик теперь проверяет, что элемент не disabled](#clicking-disable-element-fails)
* [Маскируем переводы строк в отчёте](#escape-newlines-in-report)
* [Комбинированные селекторы для мобилок](#combined-selectors-for-mobile-apps)
* [Новые проверки для мобилок](#conditions-for-mobile-apps)
* [Новые селекторы для мобилок](#new-selectors-for-mobile-apps)
* [Переключение контекста в мобилках](#switch-context-in-mobile-apps)
* [Переколбас CollectionCondition](#refactor-collection-conditions)
* [Новости](#news)
  {: .blogpost-menu}
  <br>

### Влили проект `selenide-selenoid` в `selenide` {#merge-selenide-selenoid-to-selenide}

Это позволит нам легче менять и релизить эти проекты. 
Для вас поменяется объявление зависимости.
Вместо 
```groovy
  testImplementation("org.selenide:selenide-selenoid:2.3.7")
```

Теперь нужно будет прописать:
```groovy
  testImplementation("com.codeborne:selenide-selenoid:6.15.0")
```

См. [PR 2292](https://github.com/selenide/selenide/pull/2292).

<br>

### Влили проект `selenide-appium` в `selenide` {#merge-selenide-appium-to-selenide}

Это позволит нам легче менять и релизить эти проекты.
Вам всего лишь нужно будет обновить версию `selenide-appium` с `2.8.1` на `6.15.0`

См. [PR 2291](https://github.com/selenide/selenide/pull/2291).

<br>

### Клик теперь проверяет, что элемент не disabled {#clicking-disable-element-fails}

Как вы знаете, метод `$.click()` требует, чтобы элемент был видимым (более точно: либо элемент должен быть видимый, 
либо иметь css свойство `opacity: 0`).

НО до сих пор Селенид не проверял, что элемент enabled. Другими словами,

> Селенид разрешал кликать на `disabled` элементы. 

1. **В пользу** этого решения был такой аргумент: а вдруг автор теста и хочет кликнуть на задизейбленый элемент и убедиться, что ничего не произошло?
2. **Против** этого решения был другой аргумент: такое поведение может спровоцировать нестабильные тесты: 
  * тест кликает на кнопку, не дожидаясь, пока она станет enabled
  * по факту клик не случится (но и никаких ошибок не возникнет)
  * и позже тест упадёт из-за не случившегося клика (и будет очень сложно понять, что произошло)
  * или ещё хуже: тест может остаться ложно позитивным.

В общем, теперь **аргумент №2 победил**. Теперь метод `$.click()` дождётся, пока элемент станет enabled. 
А если не станет - клик упадёт.

Теперь вы можете смело сократить все свои тесты:
> `$.shouldBe(enabled).click()` заменить на `$.click()`.

P.S. Если вы из лагеря аргумента №1, то можете вместо клика использовать `$.shouldBe(disabled)`. 

См. [issue 2288](https://github.com/selenide/selenide/issues/xxx).
Спасибо [Maksim @Au6ojlut](https://github.com/Au6ojlut) за [PR 2290](https://github.com/selenide/selenide/pull/2290).

<br>

### Маскируем переводы строк в отчёте {#escape-newlines-in-report}

Если вы пробовали использовать в тесте многострочную строку:

```java
$.shouldHave(text("Если\n дедушка\n законченный\n мудак");
```

То могли заметить, что в отчёте эта строка выглядела коряво и ломала всю таблицу. 

А теперь будет красиво. 

См. [issue 2283](https://github.com/selenide/selenide/issues/2283).
Спасибо [Maksim @Au6ojlut](https://github.com/Au6ojlut) за [PR 2284](https://github.com/selenide/selenide/pull/2284).

<br>


### Комбинированные селекторы для мобилок {#combined-selectors-for-mobile-apps}

При тестировании мобильных приложений удобно задать в одной проверке два селектора: отдельно для Android и iOS.  
Раньше приходилось придумывать вспомогательные методы или городить ифы.

Теперь же можно объявить "комбинированный" селектор с помощью `CombinedBy`:
```java
import static com.codeborne.selenide.appium.selector.CombinedBy.android;
import static com.codeborne.selenide.appium.AppiumSelectors.byTagAndName;

$(android(byText("Бибер")).ios(byText("Долик")))
  .shouldHave(text("Бибер"));
```

<br>


### Новые проверки для мобилок {#conditions-for-mobile-apps}

Аналогичное решение для проверок: теперь можно одной строкой задать "комбинированную" проверку и для Android, и для iOS
с помощью класса `CombinedAttribute`: 
```java
import static com.codeborne.selenide.appium.conditions.CombinedAttribute.android;
import static com.codeborne.selenide.appium.AppiumCondition.attribute;
import static io.appium.java_client.AppiumBy.accessibilityId;

// Проверка элемента:
$.shouldHave(attribute(
  android("content-desc").ios("name"), 
  "Гойду, Жерасимов, где, сука, ебоприпасы?"
));

// Проверка коллекции:
$$.shouldHave(attributes(android("text"), 
  "Бздила картонный", 
  "Болтун безмозглый", 
  "Вазелиновая коррекция",
  "Зять-«у*бок»",
  "Сын-отморозок"
));
```

<br>

### Новые селекторы для мобилок {#new-selectors-for-mobile-apps}

Для кучи, нас появилась пачка новых селекторов для поиска элементов по тэгу, тексту, подстроке и т.п.:
```java
import static com.codeborne.selenide.appium.AppiumSelectors.*;

$(byAttribute("content-desc", "Hello")).click();
$(byContentDescription("Hello")).click();
$(byTagAndAtttribute("android.widget.TextView", "Не")).click();
$(byTagAndName("XCUIElementTypeStaticText", "вы е")).click();
$(withTagAndName("XCUIElementTypeText", "бываться на красной площади")).click();
```

См. [issue 2300](https://github.com/selenide/selenide/issues/2300).
Спасибо [Amuthan Sakthivel](https://github.com/amuthansakthivel) за [PR 135](https://github.com/selenide/selenide-appium/pull/135).
Также см. [PR 2315](https://github.com/selenide/selenide/pull/2315).

<br>


### Переключение контекста в мобилках {#switch-context-in-mobile-apps}
Зачастую мобильные приложения открывают какой-то контент во встроенном браузере (WebView). А то и полностью построены на WebView.
При тестировании таких приложений требуется переключаться между "нативным" и "веб" контекстом.

Теперь для переключения есть удобные методы:

```java
// Тут мы в "нативном" контексте
open();
$(accessibilityId("URL input field")).setValue("www.google.com");
$(accessibilityId("Go To Site button")).click();

// Опа, и мы уже в "веб" контексте:
switchTo().context("WEBVIEW_com.saucelabs.mydemoapp.rn");
$("#i-am-not-a-robot").click();

assertThat(getContextHandles()).hasSize(2)
```

См. [PR 2308](https://github.com/selenide/selenide/pull/2308).  
Спасибо [Amuthan Sakthivel](https://github.com/amuthansakthivel) за [PR 149](https://github.com/selenide/selenide-appium/pull/149).

<br>


### Переколбас CollectionCondition {#refactor-collection-conditions}
Мы поменяли внутреннее устройство условий для коллекций (класс `CollectionCondition`).

Раньше, если вы хотели создать [кастомную проверку для коллекций](https://github.com/selenide/selenide/blob/main/src/test/java/integration/collections/CustomCollectionConditionTest.java), 
вы должны были реализовать метод `test(elements)`:
```java
var allTextsStartingWithZ = new CollectionCondition() {
  public boolean test(List<WebElement> webElements) {
    return webElements.stream()
      .map(webElement -> webElement.getText().startsWith("Z"))
      .reduce(true, (x, y) -> x && y);
  }
}
$$(".mudak").shouldHave(allTextsStartingWithZ)
```

Этот метод останется ещё на какое-то время (для сохранения обратной совместимости), 
но **рекомендуемый метод** теперь будет `check(CollectionSource collection)`:

```java
var allTextsStartingWithZ = new CollectionCondition() {
  public CheckResult check(CollectionSource collection) {
    List<WebElement> elements = collection.getElements();
    List<String> actualTexts = ElementsCollection.texts(elements);

    boolean allMatched = webElements.stream()
      .map(webElement -> webElement.getText().startsWith("Z"))
      .reduce(true, (x, y) -> x && y);
    return new CheckResult(allMatched, actualTexts);
  }
}
$$(".mudak").shouldHave(allTextsStartingWithZ)
```

### Что нам это даёт?
В будущем это откроет нам возможности для улучшений проверок коллекций:
1. Можно будет сильно ускорить проверки: например, быстро получить тексты всех элементов коллекции за один вызов JavaScript кода.
2. В сообщении об ошибке писать не "актуальные тексты на момент составления сообщения", а "актуальные тексты на момент последней проверки". 
Как в [этой проблеме](/2021/09/28/selenide-5.25.0/#actual-value-at-the-moment-of-last-check), только с коллекциями.

См. [PR 2312](https://github.com/selenide/selenide/pull/2312) и [PR 2307](https://github.com/selenide/selenide/pull/2307).

<br>

### Новости {#news}

* Исторический момент: [первый мем про селенид](https://pikabu.ru/story/selenium_selenide_i_selenoid_8376039)
* Моё выступление на новогоднем девклубе: [Думай как пиарщик](https://www.youtube.com/watch?v=jyPQzygMpoo&ab_channel=DEVCLUB.EU)
* Видос [Тестируем Spring с помощью Selenide](https://www.youtube.com/watch?v=M--_ziTZPQQ&ab_channel=kanezi) от kanezi
* Серия видосов на Testing Mini Bytes: [Selenide + Allure = Beautiful HTML Reports](https://www.youtube.com/watch?v=UQWQJ3dhgVI&ab_channel=TestingMiniBytes)
* Пост [Why we chose Selenide over Selenium](https://creatingvalue.substack.com/p/why-we-chose-selenide-over-selenium) от Amuthan Sakthivel

<center>
  <img src="{{ BASE_PATH }}/images/2023/05/selenide-meme.jpeg" width="600" alt="Selenide meme"/>
</center>
<br>


[Андрей Солнцев](http://asolntsev.github.io/)

ru.selenide.org
