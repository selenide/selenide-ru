---
layout: post
title: "Вышла Selenide 6.17.1"
description: ""
category:
header-text: "Сим-сим, отвисни!"
tags: []
---
{% include JB/setup %}

Доброе утро!

Сегодня 20 августа - [День Восстановления Независимости Эстонии](https://www.visitestonia.com/ru/%D0%BF%D0%BE%D1%87%D0%B5%D0%BC%D1%83-%D1%8D%D1%81%D1%82%D0%BE%D0%BD%D0%B8%D1%8F/%D0%B4%D0%B5%D0%BD%D1%8C-%D0%B2%D0%BE%D1%81%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F-%D1%8D%D1%81%D1%82%D0%BE%D0%BD%D1%81%D0%BA%D0%BE%D0%B9-%D1%80%D0%B5%D1%81%D0%BF%D1%83%D0%B1%D0%BB%D0%B8%D0%BA%D0%B8).  

В честь этого праздника - небольшой релиз [Selenide 6.17.1](https://github.com/selenide/selenide/milestone/188?closed=1)!


* [Отвисли зависающий вебдрайвер](#fix-hanging-webdriver)
* [Добавили поддержку `$.type()` в мобилках](#support-type-in-mobile-apps)
* [Исправили метод `$.type(Keys.*)`](#fix-type-with-keys)
* [Убрали пробелы с концов в `$$.texts()`](#remove-spaces-from-texts)
  {: .blogpost-menu}
  <br>

### Отвисли зависающий вебдрайвер {#fix-hanging-webdriver}

В релизе Selenide 6.16.0 (на самом деле [PR 2358](https://github.com/selenide/selenide/pull/2358)), в селениде случайно появилась бага, из-за которой вебдрайвер мог легко зависнуть.
А именно, если вызвать два раза подряд `open(url, pageClass)`, то вебдрайвер накрепко зависает.

> По предварительным данным, вебдрайвер перешел на нерасчётную орбиту и разбился, столкнувшись с дедлоком в параллельных потоках devtools.

Вот такие ничоси. :)

```java
  @Test
  public void вот_этот_кусок_зависает() {
    Selenide.open("https://www.google.com/", GooglePage.class);
    Selenide.open("https://www.google.com/", GooglePage.class);
  }
```

На самом деле это оказалась [бага в вебдрайвере](https://github.com/SeleniumHQ/selenium/issues/12576), 
она [легко повторяется](https://github.com/asolntsev/selenium-deadlock) и с чистым селениумом. А изменения в 
Selenide 6.16.0 просто сделали её повторение более вероятным. 

В общем, проблему мы исправили для большинства пользователей. Но не для всех (грубо говоря, селенид просто старается 
не вызывать опасный код, пока для этого нет явной необходимости).  
А полного исправления придётся ждать на стороне ведрайвера. 

См. [issue 2424](https://github.com/selenide/selenide/issues/2424) и [PR 2428](https://github.com/selenide/selenide/pull/2428).

> Огромное спасибо [extryd](https://github.com/extryd) за чёткое описание проблемы с ультрапростыми инструкциями, как её стабильно повторить.
Такое описание бага - неоценимая помощь мейнтейнерам. Все бы тикеты такие были!

<br>

### Добавили поддержку `$.type()` в мобилках {#support-type-in-mobile-apps}

В предыдущем релизе появился метод
```java
  $.type("Биомеханоиды и трансгендеры");
```
который вбивает текст медленно, с задержками. Полезно для тестирования автозаполнения, поиска и т.п.

Но оказалось, что он не работал в мобилках ([selenide-appium](https://github.com/selenide/selenide/tree/main/modules/appium)). Теперь будет работать. 

См. [issue](https://github.com/selenide/selenide/pull/2191#issuecomment-1667578383) и [PR 2408](https://github.com/selenide/selenide/pull/2408).

<br>


### Исправили метод `$.type(Keys.*)` {#fix-type-with-keys}

Вышеупомянутый метод `type` принимает не только строки, но и `CharSequence`. 
Что означает, что такой вариант тоже должен работать:
```java
  import org.openqa.selenium.Keys;

  $("input").type(Keys.ENTER);
```

Вот только он ломался, потому что пытался закастить `Keys.ENTER` (который вообще-то `CharSequence`) к типу `String`. 
В общем, теперь этот вариант тоже будет работать (хотя польза от него неясна). 

Спасибо [Oleg Berezhnoy](https://github.com/bereg2k) за наблюдательность и [issue 2422](https://github.com/selenide/selenide/issues/2422).  
Фикс в [PR 2421](https://github.com/selenide/selenide/pull/2421).

<br>

### Убрали пробелы с концов в `$$.texts()` {#remove-spaces-from-texts}

В Selenide 6.16.0 мы [ускорили работу с коллекциями](/2023/07/02/selenide-6.16.0/#speedup-collection-checks) с помощью вставок JavaScript кода.   
Но вечновнимательный [Oleg Berezhnoy](https://github.com/bereg2k) заметил, что при этом мы случайно поменяли поведение 
метода `$$.texts()`. Раньше он возвращал список текстов элементов, в которых пробелы в начале и конце обрезаны:

```java
  assertThat($$(".burnees").texts()).isEqualTo(List.of(
    "Сиг",
    "Оленегорский горняк",
    "Авиабаза Сольцы",
    "Чонгарский мост",
    "Гениченский мост"
  ));
```

А с 6.16.0 стал возвращать тексты элементов вместе с пробелами:
```java
  assertThat($$(".burnees").texts()).isEqualTo(List.of(
    "  Сиг   ",
    "    Оленегорский горняк   ",
    "       Авиабаза Сольцы      ",
    "          Чонгарский мост       ",
    "              Гениченский мост       "
  ));
```

Возможно, это спорный вопрос, как правильно, но во всяком случае так работает стандартный метод `WebElement.getText()`. 
Спорить не стали. Теперь `$$.texts()` снова обрезает пробелы в голове и хвосте.

См. [issue 2419](https://github.com/selenide/selenide/issues/2419) и [PR 2427](https://github.com/selenide/selenide/pull/2427).

<br>

<center>
  <img src="{{ BASE_PATH }}/images/2023/08/restoration-independence-taasiseseisvumispaev-estonia.png" width="300"/>
</center>


[Андрей Солнцев](http://asolntsev.github.io/)

ru.selenide.org
