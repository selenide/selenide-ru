---
layout: post
title: "Вышла Selenide 7.0.0"
description: ""
category:
header-text: "Нам 12, Java 17"
tags: []
---
{% include JB/setup %}

С днём рождения!

Да-да, в этот день 12 лет назад был сделан первый коммит в проекте Selenide.
Если интересно, здесь [видос моего рассказа к 10-летию селенида](https://www.youtube.com/watch?v=DBkLFL4E5YA&ab_channel=DEVCLUB.EU). 
 
К празднику мы выпустили мажорный релиз [Selenide 7.0.0](https://github.com/selenide/selenide/milestone/191?closed=1)
с обновлением аж сразу на Java 17.

* [Обновились на Java 17](#java17)
* [Обновили зависимости](#update-dependencies)
* [Дедлок при инициализации классов](#fix-deadlock-in-static-initialization)
* [Актуальное значение на момент проверки](#report-actual-value-at-the-moment-of-check)
* [Удалили старые методы в `Condition`](#remove-deprecated-condition-methods)
* [Удалили старые методы в `CollectionCondition`](#remove-deprecated-methods-from-collection-conditions)
* [Удалили старые методы в `ElementsCollection`](#remove-deprecated-methods-from-elements-collection)
* [Заменили `FileNotFoundException` на `FileNotDownloadedError`](#replace-file-not-found-exception)
* [Переименовали `*Exception` в `*Error`](#rename-exceptions-to-errors)
* [Удалили поддержку устаревшего `WebDriverEventListener`](#remove-deprecated-listener)
* [Удалили старые методы для Drag'n'drop](#remove-deprecated-drag-and-drop-methods)
* [Удалили устаревшие методы `$.getSelectedValue()` и `$.getSelectedText()`](#remove-deprecated-get-selected-value-methods)
* [Удалили старые аннотации для TestNG `@Report` и `@GlobalTextReport`](#remove-deprecated-testng-annotations)
* [Остальное](#remove-other-deprecated-methods)

<br>

### Обновились на Java 17 {#java17}

Чума!
Этот день настал!

Чтобы использовать Selenide 7.+, вам придётся компилировать и запускать тесты на Java 17+.  

Как же это круто, да?

Я знаю, среди вас найдутся те, кому это решение не понравится. Вы всё ещё вынуждены гонять тесты на Java 8.

Но мы не виноваты. Как вы знаете, Selenium 4.14+ перешёл с Java 8 на Java 11. 
Так что продолжать жить с Java 8 у вас всё равно не получилось бы.
Обновиться на Java 11 всё равно пришлось бы. 
Ну а дальше простое соображение: самое сложное обновление как раз с Java 8 на Java 11. 
А вот с Java 11 на Java 17 обновиться намного проще. Там и делать-то ничего не надо. 

Так что обновляйтесь смелее! 
> Жить слишком коротка, чтобы продолжать мять титьки с Java 8

См. [PR 2522](https://github.com/selenide/selenide/pull/2522).

<br>

### Обновили зависимости {#update-dependencies}

* Обновили Selenium с 4.13.0 на 4.14.1 ([PR 2505](https://github.com/selenide/selenide/pull/2505)) <small>- требует Java 11+</small>
* Обновили Appium с 8.6.0 на 9.0.0 ([PR 2505](https://github.com/selenide/selenide/pull/2505)) <small>- требует Java 11+</small>
* Обновили TestNG с 7.4.0 на 7.8.0 ([PR 2505](https://github.com/selenide/selenide/pull/2515)) <small>- требует Java 11+</small>

<br>

### Исправили дедлок при инициализации классов {#fix-deadlock-in-static-initialization}

Это старая болячка в Selenide: класс `Condition` и любой из его дочерних классов зависели друг от друга. 
Поэтому при определённых обстоятельствах мог случиться дедлок при одновременной загрузке этих классов. Крайне редко, но теоретически возможно.  

> Подробнее про static initialization deadlock можно посмотреть в видосе [Перформансные войны](https://www.youtube.com/watch?v=2J6iJLYZZUM&t=31m44s).

При этом нам пришлось переименовать базовый класс для всех проверок из `Condition` в `WebElementCondition`. 
1. Не пугайтесь, все ваши импорты типа `Condition.visible` останутся без изменений. 
2. А вот если вы написали свои самодельные проверки, то в них надо будет заменить `extends Condition` на `extends WebElementCondition`.

См. [issue 2372](https://github.com/selenide/selenide/issues/2372) и [PR 2453](https://github.com/selenide/selenide/pull/2453).

<br>

### Актуальное значение на момент проверки {#report-actual-value-at-the-moment-of-check}

Тут идёт речь не о классических проверках веб-элементов, а о [проверках "нового поколения"](/2021/07/16/selenide-5.23.0/): url, localStorage и т.п.

```java
webdriver().shouldHave(url("https://some.com/page.html"));
localStorage().shouldHave(item("mouse", "Jerry”));
sessionStorage().shouldHave(itemWithValue("mouse", "Jerry”));
clipboard().shouldHave(content("Лох, Антилохово, Шалава, Мусорка, Пуково, Попки и Бухалово"));
```

В общем, мы сделали сообщение об ошибке более корректным. 
За деталями можно сгонять в [issue 2500](https://github.com/selenide/selenide/issues/2500) и [PR 2501](https://github.com/selenide/selenide/pull/2501).

<br>

### Удалили старые методы в `Condition` {#remove-deprecated-condition-methods}

Удалили методы `apply()` и `actualValue()` в классе `Condition`. Они уже давно были помечены как `@Deprecated`.

Вас это коснётся, только если вы писали свои самодельные проверки.
Теперь вместо двух методов `apply()` и `actualValue()` вам нужно будет реализовывать лишь один метод `check`.

См. [PR 2512](https://github.com/selenide/selenide/pull/2512).

<br>

### Удалили старые методы в `CollectionCondition` {#remove-deprecated-methods-from-collection-conditions}

Аналогично предыдущему пункту, если у вас есть самодельные проверки для коллекций (`extends CollectionCondition`),
то в них вместо методов `test` и `fail` надо будет реализовать один метод `check`. 

См. [PR 2520](https://github.com/selenide/selenide/pull/2520).

<br>

### Удалили старые методы в `ElementsCollection` {#remove-deprecated-methods-from-elements-collection}

Боюсь, тут будет много чего подгорать. :)
В общем, теперь `ElementsCollection` больше **не наследует** `java.util.List`.
Изначально это наследование _случайно_ привнесло в `ElementsCollection` кучу ненужных методов (таких, как `remove()`, `removeRange`,
`clear`, `subList` или `listIterator()`), которые никогда не планировалось реализовывать. Но пользователи иногда использовали.
И даже иногда жаловались на хабре, что они не так работают.

Ну вот, теперь нет методов - нет проблем.   
В `$$` остались только те методы, которые мы считаем нужными. Аминь.

P.S. Если у вас есть цикл по элементам коллекции:
```java
  for (SelenideElement el : $$("#selenide-users .user")) {
    el.shouldBe(visible);
  }
```
то он перестанет компилироваться. 

**Быстрое решение** - добавить к нему `asFixedIterable()`:
```java
  for (SelenideElement el : $$("#selenide-users .user").asFixedIterable()) {
    el.shouldBe(visible);
  }
```

Но **правильное решение** - переписать код и избавиться от цикла. Скорее всего вам стоит написать 
[свой collection condition](https://github.com/selenide/selenide/wiki/Custom-collection-conditions).

См. [PR 2513](https://github.com/selenide/selenide/pull/2513).

<br>

### Заменили `FileNotFoundException` на `FileNotDownloadedError` {#replace-file-not-found-exception}

Раньше многие методы типа `$.download()` были объявлены как `throws FileNotFoundException`. 
И вам приходилось страдать, добавляя этот бессмысленный `throws FileNotFoundException` и в свои тесты. 
Теперь можно будет подчистить этот хлам и убрать ненужные `catch (FileNotFoundException)`, если они у вас были.

Теперь методы типа `$.download()` будут кидать `FileNotDownloadedError`, который является `AssertionError`, и его не надо ни объявлять, ни ловить. 
Если тест не смог скачать файл - тест должен упасть. Никакой дополнительной обработки не требуется.

См. [PR 2526](https://github.com/selenide/selenide/pull/2526).

<br>

### Переименовали некоторые `*Exception` классы в `*Error` {#rename-exceptions-to-errors}

Лично я не думаю, что это хоть сколько-нибудь важно.   
Но религия некоторых пользователей запрещает им называть класс `*Exception`, если он не наследует класс `java.lang.Exception`.

Ну что ж, вы уважаем все религии. 
Теперь селенидовские классы, наследующие `java.lang.Error`, будут называться `*Error`. 

> В Украине.
> Блогерка.
> Молдова.
> Беларусь.
> Таллинн.

Нам несложно.

См. [issue 2485](https://github.com/selenide/selenide/issues/2485) и [PR 2530](https://github.com/selenide/selenide/pull/2530).

<br>

### Удалили поддержку устаревшего `WebDriverEventListener` {#remove-deprecated-listener}

Мы удалили все методы типа `addListener()` с параметром типа `org.openqa.selenium.support.events.WebDriverEventListener`.

Этот класс уже давно был помечен как `@Deprecated` в селениуме.

Используйте вместо него `addListener()` с параметром `org.openqa.selenium.support.events.WebDriverListener`. 

См. [PR 2516](https://github.com/selenide/selenide/pull/2516).

<br>

### Удалили старые методы для Drag'n'drop {#remove-deprecated-drag-and-drop-methods}

Очередная чистка. Просто замените 
```java
$("#what").dragAndDropTo(where);
```

на 
```java
$("#what").dragAndDrop(to(where));
```

См. [PR 2519](https://github.com/selenide/selenide/pull/2519).

<br>

### Удалили устаревшие методы `$.getSelectedValue()` и `$.getSelectedText()` {#remove-deprecated-get-selected-value-methods}

И ещё чистка.
1. Замените `$.getSelectedValue()` на `$.getSelectedOptionValue()`
2. Замените `$.getSelectedText()` на `$.getSelectedOptionText()`

См. [PR 2521](https://github.com/selenide/selenide/pull/2521).

<br>

### Удалили старые аннотации для TestNG `@Report` и `@GlobalTextReport` {#remove-deprecated-testng-annotations}

Эти аннотации были не нужны, начиная с [Selenide 6.7.0](https://selenide.org/2022/08/04/selenide-6.7.0/#cancel-report-testng-annotation).
Просто удалите их. 
Да и TestNG удалите, чего уж там. ;)

См. [PR 2517](https://github.com/selenide/selenide/pull/2517).

<br>

### Остальное {#remove-other-deprecated-methods}

1. Замените
```java
new BearerTokenCredentials("pwd")
```
на
```java
new BearerTokenCredentials("domain", "pwd")
```
2. Замените
```java
$.should(appears);
```
на
```java
$.should(appear);   //  или просто $.shouldBe(visible)
```

3. Замените
```java
Selenide.open(url, BASIC, "username", "password");
```
на
```java
Selenide.open(url, BASIC, new BasicAuthCredentials("username", "password"));
```

См. [PR 2518](https://github.com/selenide/selenide/pull/2518).

<br>

Навстречу прогрессу!

<center>
  <img src="{{ BASE_PATH }}/images/2023/10/12-Product-Image.webp" width="300"/>
</center>

<br>

[Андрей Солнцев](http://asolntsev.github.io/)

ru.selenide.org
