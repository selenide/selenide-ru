---
layout: post
title: "Вышла Selenide 7.1.0"
description: ""
category:
header-text: "Не в ту дверь"
tags: []
---
{% include JB/setup %}

Всем привет!
С Новым Годом, с новыми надеждами! 

Сегодня у нас в меню свеженький блестящий [Selenide 7.1.0](https://github.com/selenide/selenide/milestone/199?closed=1):

* [Скачивание файлов с помощью CDP](#download-files-with-cdp)
* [Условие `animated`](#animated-condition)
* [IF с таймаутом ¯¯\_(ツ)_/¯¯](#if-with-timeout)
* [Можно кликать задизейбленные элементы](#force-click)
* [Метод `$.unfocus()`](#method-unfocus)
* [Исправили page load timeout в мобилках](#avoid-page-load-timeout-in-mobile)
* [Можно добавлять прокси фильтр многократно](#can-add-same-proxy-filter-many-times)
* [Обновили зависимости](#update-dependencies)
* [Статистика](#statistics)

<br>

### Скачивание файлов с помощью CDP {#download-files-with-cdp}

Не прошло и три года, как в Selenium завезли CDP, а мы уже сделали с помощью него скачивание файлов!
Как вы знаете, скачивать файлы в селениде можно несколькими способами: `HTTPGET`, `FOLDER`, `PROXY`.
Теперь к ним добавился ещё и `CDP`:

```java
Configuration.fileDownload = CDP;
File f = $.download();
```

либо
```java
File f = $.download(using(CDP));
```

Работает он примерно как `FOLDER`: кликает ссылку и ждёт, пока файл появится в списке скачанных. 
Только в отличие от `FOLDER`, `CDP` понимает, что загрузка завершена, не по дате файла, а по событию `Browser.downloadProgress` из CDP.  

Конечно, этот метод скачивания работает только в Chromium-браузерах. И пока только на локальном браузере. 

См. [issue 2550](https://github.com/selenide/selenide/issues/2550).
Спасибо [Sergey Brit](https://github.com/britka) за [PR 2567](https://github.com/selenide/selenide/pull/2567).

___
NB! Как контрибьютер, Сергей получает право рассказать вам о каком-то фонде на его выбор.  

Слово Сергею: 

> Призываю вас донатить фонду [ANGRY CORGI](https://www.angrycorgi.org/en).
> 
> Фонд Angry Corgi создан людьми из tech, чтобы усилить компьютерную инфраструктуру частей ПВО и ряду других 
> частей Сил Обороны Украины.   
> Фонд постоянно принимает технику из разных стран мира, а также собирает деньги на 
> закупку планшетов, телевизоров и другого коммуникационного оборудования.

Вот такая у нас теперь будет славная традиция. :)

___

<br>

### Условие `animated` для окончания анимации {#animated-condition}

Анимированные элементы могут доставить автоматизаторам немало неприятных моментов. Твой тест пытается кликнуть элемент - а он 
в этот момент куда-то двигается, сжимается, расширяется - чёрти что. И клик попадает по другому элементу. 
> Подробнее об этом в видосе [Flaky tests](https://www.youtube.com/watch?v=zOiSo1hYjF8&t=29m43s). 

Теперь можно дождаться окончания анимации с помощью такой вот команды:
```java
  $.shouldNotBe(animated);
```

Надеемся, это поможет сделать ваши тесты более стабильными. 

Спасибо [Boris Osipov](https://github.com/BorisOsipov) за [PR 2556](https://github.com/selenide/selenide/pull/2556/files).

Вы спросите, а как же селенид понимает, что анимация закончилась? Загляните в пулреквест, это интересно.
Если вкратце - с помощью JS функции `requestAnimationFrame` селенид спрашивает у браузера размеры и координаты
элемента два раза подряд (в двух разных циклах отрисовки) и проверяет, что они не изменились. Хитро, а?

<br>

### Добавили IF с таймаутом ¯¯\_(ツ)_/¯¯ {#if-with-timeout}

Много лет мы сопротивлялись, но всё-таки позволили этому случиться. :)  

Мы добавили метод `$.is(condition, timeout)`, который возвращает boolean. Теперь в своих тестах вы сможете писать ифы без try/catch.
[Ворота в ад разверзлись](/2019/12/02/advent-calendar-how-to-abuse-selenide/).

```java
  if ($("#banner").is(visible, Duration.ofSeconds(2))) {
    $("#banner .close").click();
  }
```

Логика этого ифа наверняка подпалит немало седалищ, так что будьте внимательны:
1. Если элемент видимый, он сразу вернёт `true`.
2. Если элемент невидимый, метод подождёт какое-то время (но не больше заданного таймаута), и если элемент появился - вернёт `true`.
3. А вот если элемент так и не появился, в итоге вернёт `false`.

См. [issue 2590](https://github.com/selenide/selenide/issues/2590).  
Вечный позор на [мои седины](https://github.com/asolntsev) за [PR 2640](https://github.com/selenide/selenide/pull/2640)!

> NB! Новый метод `$.is(.., Duration.ofSeconds(8))` _может быть медленным_! Результат `false` он всегда возвращает _через 8 секунд_!
Это же убийственно долго для тестов. Постарайтесь не использовать такие условия.

<br>

### Можно кликать задизейбленные элементы {#force-click}

Начиная с версии 6.15.0, селенид [не позволяет кликнуть на disabled элемент](/2023/05/29/selenide-6.15.0/#clicking-disable-element-fails).
Но иногда это бывает надо (например, проверить, что клик по такому элементу ничего не делает). 
Теперь можно обойти все проверки и тупо кликнуть на какой угодно элемент с помощью параметра `force`:

```java
  $("#disabledButton").click(usingDefaultMethod().force());
```

Не злоупотребляйте. 

См. [issue 2635](https://github.com/selenide/selenide/issues/2635) и [PR 2636](https://github.com/selenide/selenide/pull/2636).

<br>

### Метод `$.unfocus()` {#method-unfocus}

Мы добавили метод `$.unfocus()`, который убирает фокус с элемента.  

В общем-то это можно было сделать и раньше с помощью `$.pressTab()`, но у него могут быть нежелательные сайд-эффекты. 
Например, другой элемент неожиданно окажется в фокусе. А иногда по нажатию на TAB и вовсе сабмитится форма (например, при вводе OTP-кода).  

А метод `$.unfocus()` в этом смысле безопасен: он просто убирает фокус с элемента. И вы можете проверить, что сработало
автозаполнение, форматирование, подсказка и т.п. 

```java
  $("#card-number").sendKeys("1111-222-33-4444").unfocus();
  $("#preview").shouldHave(text("Pay to 1111-***-**-***4 ?"));
```

См. [issue 2638](https://github.com/selenide/selenide/issues/2638) и [PR 2639](https://github.com/selenide/selenide/pull/2639).

<br>

### Исправили page load timeout в мобилках {#avoid-page-load-timeout-in-mobile}

Был у нас маленький косячок, из-за которого мы случайно выставляли `Configuration.pageLoadTimeout` в мобильных тестах.
А Appium такую настройку не поддерживает. Из-за чего вы могли видеть такие логи:
> NotImplementedError: Not implemented yet for pageLoad

Некритично, это всего лишь warning. Но больше вы его не увидите. 

См. [issue 2612](https://github.com/selenide/selenide/issues/2612) и [PR 2628](https://github.com/selenide/selenide/pull/2628).

<br>

### Можно добавлять прокси фильтр многократно {#can-add-same-proxy-filter-many-times}

Стало чуть проще добавлять свои фильтры для селенидовского прокси. 
Теперь можно не проверять, что такой фильтр уже был добавлен ранее, а просто добавлять его каждый раз заново:

```java
  private static final RequestFilter REQUEST_LOGGER = new RequestFilter() {...}

  @BeforeEach
  final void setUp() {
    getSelenideProxy().addRequestFilter("request-logger", REQUEST_LOGGER);
  }
```

Раньше селенид ругался, что такой фильтр уже есть. А теперь будет спокойненько работать дальше (но только если это реально тот же самый фильтр).

См. [issue 2617](https://github.com/selenide/selenide/issues/2617) и [PR 2630](https://github.com/selenide/selenide/pull/2630).

<br>

### Обновили зависимости {#update-dependencies}

* bump JUnit from 5.10.1 to 5.10.2
* bump TestNG from 7.8.0 to 7.9.0
* Bump slf4jVersion from 2.0.11 to 2.0.12
* Bump LittleProxy from 2.1.1 to 2.1.2

<br>

### Статистика {#statistics}

Количество ежемесячных скачиваний Селенида перевалило за 911 тыщ!

<center>
  <img src="{{ BASE_PATH }}/images/2024/01/selenide.downloads.png" width="600px"/>
</center>


Вау.

И ещё один занимательный график.

Есть у Селенида один подпроект [`selenide-appium`](https://github.com/selenide/selenide/tree/main/modules/appium) для написания автотестов для мобилок. Раньше он не особо пользовался
спросом (по сравнению с самим Селенидом), но в этом году резко попёр вверх. 

<center>
  <img src="{{ BASE_PATH }}/images/2024/01/selenide-appium.downloads.png" width="600px"/>
</center>

Не знаю, чем это объясняется, но это круто. :)

<br>

[Андрей Солнцев](http://asolntsev.github.io/)

ru.selenide.org
